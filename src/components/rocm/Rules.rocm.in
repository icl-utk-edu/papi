PAPI_ROCM_ROOT ?= /opt/rocm

ifeq (@WITH_ROCPROFILER_VER@, V1)
ROCPSRCS += components/rocm/roc_profiler.c
else
ROCPSRCS += components/rocm/roc_profiler_v2.c
endif

COMPSRCS += components/rocm/rocm.c \
            components/rocm/roc_dispatch.c \
            components/rocm/roc_common.c \
            $(ROCPSRCS)

ifeq (@WITH_ROCPROFILER_VER@, V1)
ROCPOBJS += roc_profiler.o
else
ROCPOBJS += roc_profiler_v2.o
endif

COMPOBJS += rocm.o roc_dispatch.o roc_common.o $(ROCPOBJS)

CFLAGS += -I$(PAPI_ROCM_ROOT)/include \
          -I$(PAPI_ROCM_ROOT)/include/hsa \
          -I$(PAPI_ROCM_ROOT)/hsa/include/hsa \
          -I$(PAPI_ROCM_ROOT)/include/rocprofiler \
          -I$(PAPI_ROCM_ROOT)/rocprofiler/include \
          -g

LDFLAGS += $(LDL)

rocm.o: components/rocm/rocm.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c $< -o $@

roc_profiler.o: components/rocm/roc_profiler.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c $< -o $@

roc_profiler_v2.o: components/rocm/roc_profiler_v2.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c $< -o $@

roc_dispatch.o: components/rocm/roc_dispatch.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c $< -o $@

roc_common.o: components/rocm/roc_common.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c $< -o $@
